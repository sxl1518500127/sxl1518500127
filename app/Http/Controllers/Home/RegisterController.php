<?phpnamespace App\Http\Controllers\Home;use Illuminate\Http\Request;use App\Http\Controllers\Controller;use App\Models\Usercustomer;use Hash;use Mail;class RegisterController extends Controller{    //加载注册页面    public function index()    {    	return view('home.register.register');    }        // 执行注册    public function create(Request $request)    {    	// dump($request->all());    	$this->validate($request, [            'customername'  => 'required|regex:/^[a-zA-Z0-9_-]{4,16}$/',            'customerphone' => 'required|regex:/^1{1}[3-9]{1}[\d]{9}$/',            'code' => 'required',            'customerpass' => 'required|regex:/^[\w]{6,18}$/',            'recustomerpass' => 'required|same:customerpass',        ],[            'customername.required'=>'请填写用户名',            'customername.regex'=>'用户名必须为4到16位(字母,数字,下划线,减号)',            'customerphone.required'=>'请填写手机号',                'customerphone.regex'=>'请输入正确的手机号',            'code.required'=>'请填写验证码',            'customerpass.required'=>'请填写密码',                'customerpass.regex'=>'请填写6~18位的密码',                'recustomerpass.required'=>'请填写确认密码',                'recustomerpass.same'=>'两次密码不一致',         ]);        $phone = $request->input('customerphone',0);      	$key = $phone.'_code';    	$phone_code = session($key);    	$code = $request->input('code',0);    	if ($phone_code != $code) {    		    		echo "<script>alert('验证码错误');location.href='/register'</script>";    		exit;    	}    	if ($request->input('customerpass') != $request->input('recustomerpass')) {    		echo "<script>alert('两次密码不一致');location.href='/register'</script>";    		exit;    	}    	// 压入到数据库    	$usercustomer=new Usercustomer;        $usercustomer->customername = $request->input('customername','');        $usercustomer->customeremail = $request->input('customeremail','');    	$usercustomer->customerphone = $request->input('customerphone','');    	$usercustomer->customerpass = Hash::make($request->input('customerpass',''));        if ($usercustomer->save()) {            echo "<script>alert('注册成功');location.href='/login'</script>";        }else{            echo "<script>alert('注册失败');location.href='/register'</script>";        }    }     //发送手机号 验证码    public function show(Request $request)    {        // 接受手机号        $phone =  $request->input('phone');        // echo $phone;        $code = rand(1234,4321);        // 如果存入到redis中  注意键名覆盖        // session(['phone_code'=>$code]);        $k = $phone.'_code';        session([$k=>$code]);        $url = "http://v.juhe.cn/sms/send";        $params = array(            'key'   => '9c4ff1fa0ae42be88a6234c36e2bba5a', //您申请的APPKEY            'mobile'    => $phone, //接受短信的用户手机号码            'tpl_id'    => '177326', //您申请的短信模板ID，根据实际情况修改            'tpl_value' =>'#code#='.$code, //您设置的模板变量，根据实际情况修改            'dtype'     => 'json'        );        $paramstring = http_build_query($params);        $content = self::juheCurl($url, $paramstring);    }		    /**		 * 请求接口返回内容		 * @param  string $url [请求的URL地址]		 * @param  string $params [请求的参数]		 * @param  int $ipost [是否采用POST形式]		 * @return  string		 */		public static function juheCurl($url, $params = false, $ispost = 0)		{		    $httpInfo = array();		    $ch = curl_init();		    curl_setopt($ch, CURLOPT_HTTP_VERSION, CURL_HTTP_VERSION_1_1);		    curl_setopt($ch, CURLOPT_USERAGENT, 'JuheData');		    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 60);		    curl_setopt($ch, CURLOPT_TIMEOUT, 60);		    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);		    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);		    if ($ispost) {		        curl_setopt($ch, CURLOPT_POST, true);		        curl_setopt($ch, CURLOPT_POSTFIELDS, $params);		        curl_setopt($ch, CURLOPT_URL, $url);		    } else {		        if ($params) {		            curl_setopt($ch, CURLOPT_URL, $url.'?'.$params);		        } else {		            curl_setopt($ch, CURLOPT_URL, $url);		        }		    }		    $response = curl_exec($ch);		    if ($response === FALSE) {		        //echo "cURL Error: " . curl_error($ch);		        return false;		    }		    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);		    $httpInfo = array_merge($httpInfo, curl_getinfo($ch));		    curl_close($ch);		    return $response;		}}